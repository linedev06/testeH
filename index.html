<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Kindle-like Book Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Merriweather', serif;
        }
        #bookContent {
            width: 300px; /* Largura do livro */
            height: 450px; /* Altura do livro */
            overflow: hidden;
            position: relative;
            margin: auto;
            border: 1px solid #ccc; /* Borda para simular um livro */
            border-radius: 8px; /* Bordas arredondadas */
            background-color: white; /* Fundo branco */
        }
        #bookImage {
            width: 100%; /* Largura total do contêiner */
            height: 100%; /* Altura total do contêiner */
            object-fit: cover; /* Ajusta a imagem para cobrir o contêiner */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
<header class="bg-white shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center"><img alt="Book cover with abstract design" class="w-auto h-12 object-cover mb-4 rounded" src="Nartiva.png" style="margin-right: 5px; height: 150px; width: 100px;" />
        <nav>
            <ul class="flex space-x-4"style="margin-right: 35px;" >
                <li><a class="text-gray-700 hover:text-gray-900" href="#">Home</a></li>
               
                <li><a class="text-gray-700 hover:text-gray-900" href="song.html">Sound</a></li>
                <li><a class="text-gray-700 hover:text-gray-900" href="#">Contact</a></li>
            </ul>
        </nav>
    </div>
</header>
<main class="container mx-auto px-4 py-8" id="mainContent">
    <section class="mb-8">
        <h2 class="text-xl font-bold mb-4">Livros em destaques</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="featuredBooks">
          <a href="SLA.HTML"> <div class="bg-white p-4 rounded-lg shadow-md">
                <img alt="" class="w-full h-48 object-cover mb-4 rounded" height="300" src="vis.png" width="200"/>
                <h3 class="text-lg font-semibold mb-2">Redemption</h3>
                <p class="text-gray-700">Autor: Vitor Alves Felismino</p>
            </div></a> 
            <a href="SLA2.HTML"><div class="bg-white p-4 rounded-lg shadow-md">
                
                <img alt="Book cover with abstract design" class="w-full h-48 object-cover mb-4 rounded" height="300" src="vis3.png" width="200"/>
                <h3 class="text-lg font-semibold mb-2">Entre Nós e o Fim</h3>
                <p class="text-gray-700">Autor: Vitor Alves Felismino</p>
            </div></a>
            <a href="SLA3.HTML"><div class="bg-white p-4 rounded-lg shadow-md">
                <img alt="Book cover with abstract design" class="w-full h-48 object-cover mb-4 rounded" height="300" src="vis2.png" width="200"/>
                <h3 class="text-lg font-semibold mb-2">Star Of Rebellion I</h3>
                <p class="text-gray-700">Autor: Vitor Alves Felismino</p>
            </div></a>
            <div class="bg-white p-4 rounded-lg shadow-md">
                <img alt="Book cover with abstract design" class="w-full h-48 object-cover mb-4 rounded" height="300" src="https://storage.googleapis.com/a1aa/image/vrQedRfyLDiePIUmA60qkhMpRdLtPtDym651SO4qDRjmFeFQB.jpg" width="200"/>
                <h3 class="text-lg font-semibold mb-2">Book Title 4</h3>
                <p class="text-gray-700">Author 4</p>
            </div>
        </div>
    </section>
    <section>
        <h2 class="text-xl font-bold mb-4">Lendo agora</h2>
        <div class="bg-white p-6 rounded-lg shadow-md" id="currentBook">
            <div class="flex justify-between items-center mb-4">
                <button class="text-gray-700 hover:text-gray-900" id="prevPage"></button>
                <button class="text-gray-700 hover:text-gray-900" id="nextPage">Next</button>
            </div>
            <div id="bookContent">
                <img id="bookImage" src="" alt="Book Cover" />
                <p class="text-gray-800 leading-relaxed mb-4" id="currentPage">Page 1</p>
            </div>
        </div>
    </section>
</main>
<footer class="bg-white shadow-md mt-8">
    <div class="container mx-auto px-4 py-4 text-center">
        <p class="text-gray-700">© 2023 Book Reader. All rights reserved.</p>
    </div>
</footer>
<script>
    let currentPage = 0;
    let currentBookId = null; // ID do livro atual

    async function loadBook(bookId) {
        currentBookId = bookId; // Define o ID do livro atual
        const response = await fetch(`api.php?id=${bookId}`);
        const currentBook = await response.json();
        if (currentBook) {
            document.getElementById('bookImage').src = currentBook.cover; // Carrega a imagem do livro
            document.getElementById('bookContent').style.display = 'block'; // Exibe o conteúdo do livro
            currentPage = currentBook.current_page; // Define a página atual
            renderPage(); // Renderiza a página
        }
    }

    document.getElementById('nextPage').addEventListener ('click', async function() {
        currentPage++;
        renderPage();
        await saveCurrentBook('Current Book Title', 'Current Author', currentPage, document.getElementById('bookImage').src);
    });

    document.getElementById('prevPage').addEventListener('click', async function() {
        if (currentPage > 0) {
            currentPage--;
            renderPage();
            await saveCurrentBook('Current Book Title', 'Current Author', currentPage, document.getElementById('bookImage').src);
        }
    });

    function renderPage() {
        document.getElementById('currentPage').innerText = `Page ${currentPage + 1}`; // Atualiza a página atual
    }

    async function saveCurrentBook(bookTitle, bookAuthor, currentPage, cover) {
        const response = await fetch('api.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ title: bookTitle, author: bookAuthor, currentPage, cover }),
        });
        return await response.json();
    }

    // Carregar o livro ao iniciar
    loadCurrentBook(1);
    document.getElementById('nextPage').addEventListener('click', async function() {
        if (currentPage < pages.length - 1) {
            currentPage++;
            renderPage();
            await saveCurrentBook(document.querySelector('#chapterTitle').innerText, document.querySelector('#currentAuthor').innerText, currentPage);
        }
    });

    document.getElementById('prevPage').addEventListener('click', async function() {
        if (currentPage > 0) {
            currentPage--;
            renderPage();
            await saveCurrentBook(document.querySelector('#chapterTitle').innerText, document.querySelector('#currentAuthor').innerText, currentPage);
        }
    });

    function renderPage() {
        document.getElementById('bookContent').innerHTML = `Page ${currentPage + 1} content...`;
    }

    // Carregar o livro ao iniciar
    loadCurrentBook(1);

document.getElementById('nextPage').addEventListener('click', async function() {
    if (currentPage < pages.length - 1) {
        currentPage++;
        renderPage();
        await saveCurrentBook('Current Book Title', 'Current Author', currentPage); // Substitua pelos valores reais
    }
});

document.getElementById('prevPage').addEventListener('click', async function() {
    if (currentPage > 0) {
        currentPage--;
        renderPage();
        await saveCurrentBook('Current Book Title', 'Current Author', currentPage); // Substitua pelos valores reais
    }
});

function renderPage() {
    // Aqui você pode adicionar a lógica para renderizar o conteúdo da página
    document.getElementById('bookContent').innerHTML = `Page ${currentPage + 1} content...`;
}

// Carregar o livro ao iniciar
loadCurrentBook(1); // Carregue o livro com ID 1 (ou outro ID que você tenha salvo no banco de dados)

// Modifique o evento de clique do botão "Next" e "Previous" para salvar a página atual
document.getElementById('nextPage').addEventListener('click', function() {
    if (currentPage < pages.length - 1) {
        currentPage++;
        renderPage();
        saveCurrentBook('Current Book Title', 'Current Author', currentPage); // Substitua pelos valores reais
    }
});

document.getElementById('prevPage').addEventListener('click', function() {
    if (currentPage > 0) {
        currentPage--;
        renderPage();
        saveCurrentBook('Current Book Title', 'Current Author', currentPage); // Substitua pelos valores reais
    }
});









    
    document.getElementById('uploadButton').addEventListener('click', function() {
        document.getElementById('uploadModal').classList.remove('hidden');
    });

    document.getElementById('cancelUpload').addEventListener('click', function() {
        document.getElementById('uploadModal').classList.add('hidden');
    });

    document.getElementById('uploadForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const bookTitle = document.getElementById('bookTitle').value;
        const bookAuthor = document.getElementById('bookAuthor').value;
        const bookCover = document.getElementById('bookCover').value;
        const bookFile = document.getElementById('bookFile').files[0];

        if (bookFile) {
            const reader = new FileReader();
            if (bookFile.type === 'application/pdf') {
                reader.onload = function(e) {
                    const loadingTask = pdfjsLib.getDocument({data: e.target.result});
                    loadingTask.promise.then(function(pdf) {
                        let content = '';
                        const numPages = pdf.numPages;
                        let pagesProcessed = 0;
                        for (let i = 1; i <= numPages; i++) {
                            pdf.getPage(i).then(function(page) {
                                page.getTextContent().then(function(textContent) {
                                    textContent.items.forEach(function(item) {
                                        content += item.str + ' ';
                                    });
                                    pagesProcessed++;
                                    if (pagesProcessed === numPages) {
                                        document.getElementById('bookContent').innerHTML = content.split('\n').map(line => <p class="text-gray-800 leading-relaxed mb-4">${line}</p>).join('');
                                        paginateContent();
                                    }
                                });
                            });
                        }
                    });
                };
                reader.readAsArrayBuffer(bookFile);
            } else if (bookFile.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                reader.onload = function(e) {
                    const zip = new JSZip(e.target.result);
                    const doc = new window.docxtemplater().loadZip(zip);
                    const text = doc.getFullText();
                    document.getElementById('bookContent').innerHTML = text.split('\n').map(line => <p class="text-gray-800 leading-relaxed mb-4">${line}</p>).join('');
                    paginateContent();
                };
                reader.readAsArrayBuffer(bookFile);
            } else {
                reader.onload = function(e) {
                    const content = e.target.result.split('\n').map(line => <p class="text-gray-800 leading-relaxed mb-4">${line}</p>).join('');
                    document.getElementById('bookContent').innerHTML = content;
                    paginateContent();
                };
                reader.readAsText(bookFile);
            }

            const newBook = document.createElement('div');
            newBook.classList.add('bg-white', 'p-4', 'rounded-lg', 'shadow-md');
            newBook.innerHTML = `
                <img src="${bookCover}" alt="Book cover with abstract design" class="w-full h-48 object-cover mb-4 rounded" />
                <h3 class="text-lg font-semibold mb-2">${bookTitle}</h3>
                <p class="text-gray-700">${bookAuthor}</p>
            `;
            document.getElementById('featuredBooks').appendChild(newBook);

            document.getElementById('uploadModal').classList.add('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('readingScreen').classList.remove('hidden');
        }
    });

    let currentFontSize = 16;
    document.getElementById('increaseFontSize').addEventListener('click', function() {
        currentFontSize += 2;
        document.getElementById('bookContent').style.fontSize = currentFontSize + 'px';
        paginateContent();
    });

    document.getElementById('decreaseFontSize').addEventListener('click', function() {
        if (currentFontSize > 12) {
            currentFontSize -= 2;
            document.getElementById('bookContent').style.fontSize = currentFontSize + 'px';
            paginateContent();
        }
    });


    function paginateContent() {
        const content = document.getElementById('bookContent').innerHTML;
        const lines = content.split('</p>');
        const pageSize = Math.floor(document.getElementById('bookContent').clientHeight / (currentFontSize * 1.5));
        pages = lines.map((_, i, arr) => arr.slice(i * pageSize, (i + 1) * pageSize).join('</p>'));
        renderPage();
    }

    function renderPage() {
        document.getElementById('bookContent').innerHTML = pages[currentPage] || '';
    }

    document.getElementById('nextPage').addEventListener('click', function() {
        if (currentPage < pages.length - 1) {
            currentPage++;
            renderPage();
        }
    });

    document.getElementById('prevPage').addEventListener('click', function() {
        if (currentPage > 0) {
            currentPage--;
            renderPage();
        }
    });

    document.getElementById('backToHome').addEventListener('click', function() {
        document.getElementById('mainContent').classList.remove('hidden');
        document.getElementById('readingScreen').classList.add('hidden');
    });

    paginateContent();
</script>
</body>
</html>